{
  "meta": {
    "project": "Timesheet Report Module",
    "date": "2025-10-04",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "The Timesheet Report Module is an advanced reporting component within the Timesheet Management System that enables authorized users to browse, customize, execute, and schedule reports based on labor and project data. It supports comprehensive data selection across multiple linked tables, advanced filtering, calculated fields, aggregation, and flexible export options to empower business intelligence and operational workflows.",
  "core_goals": [
    "Provide flexible report schema customization by allowing users to select and save fields across multiple linked tables.",
    "Enable self-service analytics with easy report browsing, execution, and scheduling without IT dependency.",
    "Ensure data accuracy by generating reports directly from approved timesheet data with configurable filters and validations.",
    "Support efficient operational reporting through features like report scheduling, export, and user preference management.",
    "Facilitate advanced data analysis via calculated fields, aggregation functions, and grouping capabilities."
  ],
  "key_features": [
    "Report Catalog Browser with metadata including last viewed date and execution time.",
    "Report schema display including field types, labels, calculated fields, and aggregation.",
    "Report execution view with paginated and sortable data tables.",
    "Report customization interface allowing multi-table joins, column selection, and order management.",
    "Advanced filtering system supporting multiple conditions, AND/OR logic, and data type specific operators.",
    "Calculated fields with full formula support and arithmetic operations, including parentheses handling.",
    "Aggregation and grouping functions (SUM, AVG, MIN, MAX) with multi-level grouping support.",
    "Export functionality to CSV, Excel (XLSX), and PDF formats with formatting.",
    "User preferences for columns, filters, and timestamps persistence with localStorage and Supabase backup.",
    "Keyboard shortcuts for filtering and exporting during report views.",
    "Clear user feedback via toast notifications."
  ],
  "user_flow_summary": [
    "User logs in and accesses the Report Module main page showing a list of reports with last run and execution time.",
    "User selects a report and clicks 'View' to run and see data in a paginated, sortable table with no filters by default.",
    "User opens report customization to add/to remove tables, select specific columns, and reorder fields with real-time counters updating.",
    "User defines filters in the dedicated filter section using data-type aware operators and compound conditions with AND/OR logic.",
    "User creates calculated fields by defining formulas referencing existing fields, selects output data type and verifies syntax.",
    "User applies aggregation functions to numerical columns and selects grouping fields to segment report data.",
    "User saves custom report schemas or cancels changes with undo confirmation.",
    "User schedules reports for automated execution and email distribution with defined frequency and formats.",
    "User exports report data to CSV, Excel, or PDF via export buttons or keyboard shortcuts, receiving success/error toasts."
  ],
  "validation_criteria": [
    "Report list displays authorized reports only with correct and updated last viewed and execution times.",
    "Report execution starts immediately on 'View' and shows progress, results in table with pagination, handling errors gracefully.",
    "Edit, Copy, Delete actions on report schema respect user roles with confirmations and do not affect originals when copied.",
    "Report customization correctly adds/removes linked tables with automatic foreign key linking and displays selection accurately.",
    "Column selection supports select all/deselect all per table with immediate update of counters and disallows removing primary table.",
    "Filter interface shows appropriate operators and input controls per data type, supports compound AND/OR filters, and does not persist filters.",
    "Calculated field formulas support standard math, parentheses, and existing fields with validation against errors.",
    "Aggregation functions return correct SUM, AVG, MIN, MAX by group when grouping fields are defined.",
    "Output formatting allows currency, percentage, decimals, and date formats selectable by user with defaults, overriding for calculated fields.",
    "Scheduled reports execute at set intervals with email delivery and failure notifications.",
    "Exports produce correctly formatted files matching the report view."
  ],
  "code_summary": {
    "tech_stack": [
      "JavaScript",
      "React 18",
      "Vite 5",
      "Tailwind CSS",
      "React Router DOM",
      "Supabase",
      "jsPDF",
      "xlsx",
      "LocalStorage"
    ],
    "features": [
      {
        "name": "Report Catalog Browser",
        "description": "Displays available reports organized by categories with metadata like last viewed date and execution time. Users can expand reports to view their schema definition.",
        "files": [
          "src/reports/ReportSelectorPage.jsx",
          "src/services/reportCatalog.js"
        ]
      },
      {
        "name": "Report Schema Display",
        "description": "Shows detailed schema information for each report including field types, formats, required status, and calculations.",
        "files": [
          "src/reports/components/ReportSchemaTable.jsx",
          "src/services/reportCatalog.js"
        ]
      },
      {
        "name": "Report Display and Data Table",
        "description": "Main report view with paginated, sortable table displaying report data with configurable page sizes and navigation controls.",
        "files": [
          "src/reports/ReportPage.jsx",
          "src/reports/components/ReportTable.jsx"
        ]
      },
      {
        "name": "Column Customization",
        "description": "Allows users to select multiple Supabase tables and choose specific columns to display in their custom reports. Supports multi-table joins and column prefixing.",
        "files": [
          "src/reports/ReportCustomize.jsx",
          "src/services/reportPreferences.js"
        ]
      },
      {
        "name": "Advanced Filtering System",
        "description": "Comprehensive filtering interface with multiple conditions (equals, not equals, greater than, less than, contains, starts with, ends with) and support for AND/OR logical operations.",
        "files": [
          "src/reports/ReportFilter.jsx",
          "src/services/reportPreferences.js"
        ]
      },
      {
        "name": "Data Export Functionality",
        "description": "Exports report data to multiple formats including CSV, Excel (XLSX), and PDF with formatted tables and headers.",
        "files": [
          "src/reports/components/ExportButtons.jsx",
          "src/services/reportService.js"
        ]
      },
      {
        "name": "Sorting and Pagination",
        "description": "Client-side and server-side sorting by any column with ascending/descending order. Pagination with customizable page sizes (10, 20, 50, 100 rows).",
        "files": [
          "src/reports/components/ReportTable.jsx",
          "src/services/reportService.js"
        ]
      },
      {
        "name": "Supabase Data Integration",
        "description": "Fetches data from Supabase database tables with support for single and multi-table queries, filtering, sorting, and pagination.",
        "files": [
          "src/services/reportService.js",
          "src/services/supabaseClient.js"
        ]
      },
      {
        "name": "Mock Data Service",
        "description": "Provides fallback mock employee timesheet data for testing and development when Supabase tables are not configured.",
        "files": [
          "src/services/reportService.js"
        ]
      },
      {
        "name": "Report Preferences Storage",
        "description": "Saves and retrieves user preferences for report columns, filters, and last viewed timestamps using localStorage with Supabase backup.",
        "files": [
          "src/services/reportPreferences.js"
        ]
      },
      {
        "name": "Searchable Select Component",
        "description": "Reusable dropdown component with search/filter functionality for selecting from large lists of options.",
        "files": [
          "src/reports/components/SearchableSelect.jsx"
        ]
      },
      {
        "name": "Toast Notifications",
        "description": "User feedback system for displaying success, error, and informational messages.",
        "files": [
          "src/components/Toast.jsx"
        ]
      },
      {
        "name": "Date Formatting Utilities",
        "description": "Helper functions for formatting dates in MM/DD/YYYY format and other date-related operations.",
        "files": [
          "src/services/date.js"
        ]
      },
      {
        "name": "Application Routing",
        "description": "React Router setup with routes for report selector, individual reports, customization, and filtering pages.",
        "files": [
          "src/main.jsx"
        ]
      },
      {
        "name": "Keyboard Shortcuts",
        "description": "Supports keyboard shortcuts like Ctrl+F for filters and Ctrl+E for export in the report view.",
        "files": [
          "src/reports/ReportPage.jsx"
        ]
      }
    ]
  }
}
